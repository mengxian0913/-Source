#include <stdio.h>
#include <string.h>
#include "NUC100Series.h"
#include "MCU_init.h"
#include "SYS_init.h"
#include "Scankey.h"
#include "LCD.h"
#include "Seven_Segment.h"

int a, b, onClear;

void Display_7seg()
{
    int i;
    int arr[3];
    arr[0] = a;
    arr[1] = b;
    arr[2] = onClear;
    // 3 2 1 0
    for(i = 0; i < 3; i++) {
        CloseSevenSegment();
        ShowSevenSegment(i, arr[i]);
        CLK_SysTickDelay(2000);
    }
  return;
}

void solve(int a, int b) {
    char line[4][128];
    int i = 0;
    memset(line, 0, sizeof(line));
    sprintf(line[0], "%d + %d = %d", a, b, a + b);
    sprintf(line[1], "%d - %d = %d", a, b, a - b);
    sprintf(line[2], "%d * %d = %d", a, b, a * b);
    sprintf(line[3], "%d / %d = %d", a, b, a / b);
    for(i = 0; i < 4; i++) {
        print_Line(i, line[i]);
    }
    return;
}

int main(void)
{
    int i = 0, keyPressed = 0;
    onClear = 0, a = 0, b = 0;
    SYS_Init();
    OpenKeyPad();
    GPIO_SetMode(PB, BIT11, GPIO_MODE_OUTPUT);
    init_LCD();
    
    
    while(1) {
        i=ScanKey();
        Display_7seg();

        if( i == 0 ) {
            keyPressed = 0;
            continue;
        }
        
        if(keyPressed) {
            continue;
        }
        
        keyPressed = 1;
        
        if ( onClear ) {
            onClear = 0;
            a = b = 0;
            clear_LCD();
            continue;
        }
        
        if ( a == 0 ) {
            a = i;
        } else if( b == 0 ) {
            b = i;
            solve(a, b);
            onClear = 1;
        }
    }
    
    return 0;
}
